if (length(idx_only_alt)) {
rug(x1[idx_only_alt], side = 1, col = "red", lwd = 3, cex = 1.5)
}
if (i == 1) {
legend("bottom", xpd = NA, bty = "n",
lwd = 3, lty = c(1, 2), col = c("black", "grey"),
legend = c("smc", "alt1"),
cex = 1.2)  # make legend text larger
}
}
if (!is.null(tickers)) {
used_lbl <- paste(tickers[j_set], collapse = ", ")
} else {
used_lbl <- paste("j =", paste(j_set, collapse = ", "))
}
mtext(paste("CoVaR cumulative conditional hit proportion - SMC vs ALT1. Tickers:", used_lbl), outer = TRUE, cex = 1.3)
par(op)
dev.off()
png("covar_hits_j123.png", width = 1000, height = 800)
op <- par(
mfrow = c(3, 1),
mar   = c(3.2, 4.2, 2.2, 1.2),
oma   = c(0, 0, 1.5, 0),
cex.axis = 1.5   # <- enlarge x and y tick labels
)
for (i in seq_along(j_set)) {
j <- j_set[i]
ts_smc  <- covar_hits_timeseries(out_list$smc,  data, j, a, b, date_from, date_to)
ts_alt1 <- covar_hits_timeseries(out_list$alt1, data, j, a, b, date_from, date_to)
x1  <- ts_smc$Date
x2  <- ts_alt1$Date
y1p <- ts_smc$cum_prop
y2p <- ts_alt1$cum_prop
ylim2 <- c(0, 0.2)
main_lbl <- if (!is.null(tickers)) {
paste0("CoVaR cumulative conditional hit proportion — j = ", tickers[j])
} else paste0("CoVaR cumulative conditional hit proportion — j = ", j)
plot(x1, y1p, type = "s", lwd = 3,
xlab = if (i == length(j_set)) "Date" else "",
ylab = "",
ylim = ylim2)
lines(x2, y2p, type = "s", lwd = 3, lty = 2, col = "grey")
abline(h = b, col = "gray60", lty = 3)
idx_only_alt <- which(ts_alt1$hit == 1L & ts_smc$hit == 0L)
if (length(idx_only_alt)) {
rug(x1[idx_only_alt], side = 1, col = "red", lwd = 3, cex = 1.5)
}
if (i == 1) {
legend("bottom", xpd = NA, bty = "n",
lwd = 3, lty = c(1, 2), col = c("black", "grey"),
legend = c("smc", "alt1"),
cex = 1.4)  # make legend text larger
}
}
if (!is.null(tickers)) {
used_lbl <- paste(tickers[j_set], collapse = ", ")
} else {
used_lbl <- paste("j =", paste(j_set, collapse = ", "))
}
mtext(paste("CoVaR cumulative conditional hit proportion - SMC vs ALT1. Tickers:", used_lbl), outer = TRUE, cex = 1.3)
par(op)
dev.off()
png("covar_hits_j123.png", width = 1000, height = 800)
op <- par(
mfrow = c(3, 1),
mar   = c(3.2, 4.2, 2.2, 1.2),
oma   = c(0, 0, 1.5, 0),
cex.axis = 1.5   # <- enlarge x and y tick labels
)
for (i in seq_along(j_set)) {
j <- j_set[i]
ts_smc  <- covar_hits_timeseries(out_list$smc,  data, j, a, b, date_from, date_to)
ts_alt1 <- covar_hits_timeseries(out_list$alt1, data, j, a, b, date_from, date_to)
x1  <- ts_smc$Date
x2  <- ts_alt1$Date
y1p <- ts_smc$cum_prop
y2p <- ts_alt1$cum_prop
ylim2 <- c(0, 0.2)
main_lbl <- if (!is.null(tickers)) {
paste0("CoVaR cumulative conditional hit proportion — j = ", tickers[j])
} else paste0("CoVaR cumulative conditional hit proportion — j = ", j)
plot(x1, y1p, type = "s", lwd = 3,
xlab = if (i == length(j_set)) "Date" else "",
ylab = "",
ylim = ylim2)
lines(x2, y2p, type = "s", lwd = 3, lty = 2, col = "grey")
abline(h = b, col = "gray60", lty = 3)
idx_only_alt <- which(ts_alt1$hit == 1L & ts_smc$hit == 0L)
if (length(idx_only_alt)) {
rug(x1[idx_only_alt], side = 1, col = "red", lwd = 3, cex = 1.5)
}
if (i == 1) {
legend("bottom", xpd = NA, bty = "n",
lwd = 3, lty = c(1, 2), col = c("black", "grey"),
legend = c("smc", "alt1"),
cex = 1.6)  # make legend text larger
}
}
if (!is.null(tickers)) {
used_lbl <- paste(tickers[j_set], collapse = ", ")
} else {
used_lbl <- paste("j =", paste(j_set, collapse = ", "))
}
mtext(paste("CoVaR cumulative conditional hit proportion - SMC vs ALT1. Tickers:", used_lbl), outer = TRUE, cex = 1.3)
par(op)
dev.off()
# --- choose the three institutions you want to show ---------------------------
j_set <- c(1, 3, 5)   # <- pick the 3 j you want (indices of institutions)
a <- 0.1; b <- 0.1
date_from <- as.Date("2004-01-01")
date_to   <- as.Date("2025-01-01")
tickers <- setdiff((colnames(data$U)  ), "date")
png("covar_hits_j123.png", width = 1000, height = 800)
op <- par(
mfrow = c(3, 1),
mar   = c(3.2, 4.2, 2.2, 1.2),
oma   = c(0, 0, 1.5, 0),
cex.axis = 1.5   # <- enlarge x and y tick labels
)
for (i in seq_along(j_set)) {
j <- j_set[i]
ts_smc  <- covar_hits_timeseries(out_list$smc,  data, j, a, b, date_from, date_to)
ts_alt1 <- covar_hits_timeseries(out_list$alt1, data, j, a, b, date_from, date_to)
x1  <- ts_smc$Date
x2  <- ts_alt1$Date
y1p <- ts_smc$cum_prop
y2p <- ts_alt1$cum_prop
ylim2 <- c(0, 0.2)
main_lbl <- if (!is.null(tickers)) {
paste0("CoVaR cumulative conditional hit proportion — j = ", tickers[j])
} else paste0("CoVaR cumulative conditional hit proportion — j = ", j)
plot(x1, y1p, type = "s", lwd = 3,
xlab = if (i == length(j_set)) "Date" else "",
ylab = "",
ylim = ylim2)
lines(x2, y2p, type = "s", lwd = 3, lty = 2, col = "grey")
abline(h = b, col = "gray60", lty = 3)
idx_only_alt <- which(ts_alt1$hit == 1L & ts_smc$hit == 0L)
if (length(idx_only_alt)) {
rug(x1[idx_only_alt], side = 1, col = "red", lwd = 3, cex = 1.5)
}
if (i == 1) {
legend("bottom", xpd = NA, bty = "n",
lwd = 3, lty = c(1, 2), col = c("black", "grey"),
legend = c("smc", "alt1"),
cex = 1.8)  # make legend text larger
}
}
if (!is.null(tickers)) {
used_lbl <- paste(tickers[j_set], collapse = ", ")
} else {
used_lbl <- paste("j =", paste(j_set, collapse = ", "))
}
mtext(paste("CoVaR cumulative conditional hit proportion - SMC vs ALT1. Tickers:", used_lbl), outer = TRUE, cex = 1.3)
par(op)
dev.off()
data$U$date
out = out_list$smc
# fam_hist: array [particles x time x edges]
fh <- out$fam_hist
dim(fh)
# [1] 1000 6289    3
n_edges <- dim(fh)[3]
n_time  <- dim(fh)[2]
# All labels present in the array
labels_all <- sort(unique(as.vector(fh)))
data$U$date
out = out_list$smc
# fam_hist: array [particles x time x edges]
fh <- out$fam_hist
dim(fh)
# [1] 1000 6289    3
n_edges <- dim(fh)[3]
n_time  <- dim(fh)[2]
# All labels present in the array
labels_all <- sort(unique(as.vector(fh)))
# ---- compute proportions -----------------------------------------------------
# result: list of length n_edges, each element is matrix [time x labels]
prop_list <- vector("list", n_edges)
for (e in 1:n_edges) {
# slice array for edge e: matrix [particles x time]
slice <- fh[, , e]
# initialize matrix: n_time rows, one col per label
mat <- matrix(NA_real_, nrow = n_time, ncol = length(labels_all))
colnames(mat) <- labels_all
# loop over time
for (t in 1:n_time) {
counts <- table(factor(slice[, t], levels = labels_all))
mat[t, ] <- counts / sum(counts)
}
prop_list[[e]] <- mat
}
names(prop_list) <- paste0("edge", 1:n_edges)
op <- par(no.readonly = TRUE)
par(mfrow = c(3,1), mar = c(4,4,2,1))
time_index <- data$U$date
cols <- 1:length(labels_all)  # simple color set
for (e in 1:n_edges) {
mat <- prop_list[[e]]
plot(time_index, mat[,1], type = "l", ylim = c(0,1),
xlab = "Time", ylab = "Proportion",
main = paste("Edge", e),
col = cols[1], lwd = 2)
if (ncol(mat) > 1) {
for (j in 2:ncol(mat)) {
lines(time_index, mat[,j], col = cols[j], lwd = 2)
}
}
legend("topright", legend = colnames(mat), col = cols, lwd = 2, bty = "n")
}
par(op)
# --------- scoring primitives (vectorized) ----------
qs_quantile <- function(y, q, alpha) {
# check loss / pinball loss
(alpha - as.numeric(y <= q)) * (y - q)
}
qs_LM <- function(y, q) {
# Lopez-Mancini
ifelse(y < q, 1 + (y - q)^2, 0)
}
qs_LA <- function(y, q, alpha, ahat) {
# Lopez-Aragon with inflation factor P based on empirical coverage ahat
P <- if (is.finite(ahat) && ahat > alpha) exp((ahat - alpha) / alpha) else 1
ifelse(y < q, P * (1 + abs(y - q)), abs(y - q))
}
# --------- build conditional CoVaR evaluation sample ----------
# Returns dates, mask of conditioning events, portfolio y, CoVaR threshold q
covar_eval_sample <- function(out, data, j, a = 0.10, b = 0.10,
date_from = as.Date("2004-01-01"),
date_to   = as.Date("2100-01-01"),
assets    = NULL) {
al <- align_and_filter(out, data, date_from, date_to, keep_cols = assets)
Y        <- al$Y_keep
keep_idx <- al$keep_idx
dates    <- al$dates_oos[keep_idx]
d        <- ncol(Y)
tickers  <- colnames(Y)
if (j < 1L || j > d) stop("j out of bounds")
rp <- rowMeans(Y)
alphas_out <- if (!is.null(out$cfg$alphas)) as.numeric(out$cfg$alphas) else stop("cfg$alphas missing")
k   <- .which_alpha(alphas_out, a)
lab <- paste0("a", a, "b", b)
riskVaR <- out$risk$VaR[keep_idx, , , drop = FALSE]
CoVaR   <- out$CoVaR_tail[keep_idx, , , drop = FALSE]
# align asset order if dimnames exist
if (!is.null(dimnames(riskVaR)[[2]])) {
pos <- match(tickers, dimnames(riskVaR)[[2]])
if (anyNA(pos)) stop("Tickers not found in riskVaR dimnames.")
riskVaR <- riskVaR[, pos, , drop = FALSE]
if (!is.null(dimnames(CoVaR)[[2]])) CoVaR <- CoVaR[, pos, , drop = FALSE]
}
# fallback for labels like "a0.10b0.10"
labs_avail <- dimnames(CoVaR)[[3]]
if (!is.null(labs_avail) && !(lab %in% labs_avail)) {
lab_alt <- paste0("a", formatC(a, format = "f", digits = 2),
"b", formatC(b, format = "f", digits = 2))
if (lab_alt %in% labs_avail) lab <- lab_alt
}
VaRj  <- matrix(riskVaR[, , k], ncol = d); colnames(VaRj) <- tickers
CoVab <- CoVaR[, , lab, drop = FALSE][, , 1]; colnames(CoVab) <- tickers
mask <- Y[, j] <= VaRj[, j]       # conditioning events (asset j at level a)
q    <- CoVab[, j]                # CoVaR threshold for portfolio
y    <- rp                        # realized portfolio return
list(dates = dates, mask = mask, y = y, q = q,
asset_j = tickers[j], alpha_j = a, alpha_p = b)
}
# --------- compute CoVaR score time series + summary ----------
covar_scores <- function(out, data, j, a = 0.10, b = 0.10,
date_from = as.Date("2005-01-01"),
date_to   = as.Date("2100-01-01"),
assets    = NULL) {
ev <- covar_eval_sample(out, data, j, a, b, date_from, date_to, assets)
dates <- ev$dates; mask <- ev$mask; y <- ev$y; q <- ev$q
# restrict to conditioning days to compute ahat (empirical conditional coverage)
hits <- as.numeric(y[mask] <= q[mask])
ahat <- if (any(mask)) mean(hits) else NA_real_
# build time series (NA outside event days)
qs  <- rep(NA_real_, length(dates))
lm  <- rep(NA_real_, length(dates))
la  <- rep(NA_real_, length(dates))
if (any(mask)) {
qs[mask] <- qs_quantile(y[mask], q[mask], b)   # quantile score at level b
lm[mask] <- qs_LM(y[mask], q[mask])
la[mask] <- qs_LA(y[mask], q[mask], b, ahat)
}
# aggregates over event days
agg <- list(
T_event = sum(mask),
mean_qs = if (any(mask)) mean(qs[mask]) else NA_real_,
mean_LM = if (any(mask)) mean(lm[mask]) else NA_real_,
mean_LA = if (any(mask)) mean(la[mask]) else NA_real_,
alpha_target = b,
alpha_hat    = ahat
)
list(
dates = dates, mask = mask, y = y, q = q,
quantile_score = qs, LM = lm, LA = la,
summary = agg,
meta = list(asset_j = ev$asset_j, alpha_j = ev$alpha_j, alpha_p = ev$alpha_p)
)
}
covar_scores_compare <- function(out_list_named, data, j, a = 0.10, b = 0.10,
date_from = as.Date("2005-01-01"),
date_to   = as.Date("2100-01-01"),
assets    = NULL) {
stopifnot(!is.null(names(out_list_named)), all(nzchar(names(out_list_named))))
res <- lapply(names(out_list_named), function(m) {
s <- covar_scores(out_list_named[[m]], data, j, a, b, date_from, date_to, assets)
data.frame(
model     = m,
asset_j   = s$meta$asset_j,
alpha_j   = s$meta$alpha_j,
alpha_p   = s$meta$alpha_p,
T_event   = s$summary$T_event,
alpha_hat = s$summary$alpha_hat,
mean_qs   = s$summary$mean_qs,
mean_LM   = s$summary$mean_LM,
mean_LA   = s$summary$mean_LA,
row.names = NULL
)
})
do.call(rbind, res)
}
plot_scores_series <- function(s, main_tag="model") {
# step plots only on event days (NA elsewhere)
op <- par(no.readonly=TRUE); on.exit(par(op))
par(mfrow=c(3,1), mar=c(4,4,2,1))
with(s, {
plot(dates, quantile_score, type="s", lwd=2, xlab="Date",
ylab="Quantile score", main=paste("Quantile score |", main_tag))
abline(h=0, lty=3, col="gray60")
plot(dates, LM, type="s", lwd=2, xlab="Date", ylab="LM",
main=paste("LM |", main_tag))
plot(dates, LA, type="s", lwd=2, xlab="Date", ylab="LA",
main=paste("LA |", main_tag))
})
}
# Single model, scores:
s1 <- covar_scores(out_list$smc, data, j=2, a=0.10, b=0.10,
date_from=as.Date("2003-01-01"), date_to=as.Date("2025-01-01"))
str(s1$summary)
# Compare models on mean scores:
tbl <- covar_scores_compare(out_list, data, j=2, a=0.10, b=0.10,
date_from=as.Date("2003-01-01"), date_to=as.Date("2025-01-01"))
print(tbl)
##############################################
# ========= cumulative LM/LA plots for ONE asset j, comparing smc vs alt1 ======
# Settings ---------------------------------------------------------------------
j_sel     <- 2                  # <-- pick the conditioning asset index
a <- 0.10; b <- 0.10            # CoVaR^{b | j at a}
date_from <- as.Date("2003-01-01")
date_to   <- as.Date("2025-01-01")
assets_sel <- NULL              # or c("AIG","AXP","BAC", ...)
# Compute score series for both models (uses your existing covar_scores) -------
s_smc  <- covar_scores(out_list$smc,  data, j = j_sel, a = a, b = b,
date_from = date_from, date_to = date_to, assets = assets_sel)
s_alt1 <- covar_scores(out_list$alt1, data, j = j_sel, a = a, b = b,
date_from = date_from, date_to = date_to, assets = assets_sel)
# Helper: align two time series by Date and build cumulative sums --------------
build_cum <- function(dates1, x1, dates2, x2) {
# x1/x2 have NAs outside conditioning days — treat NAs as 0 for cumulation
DT <- data.table(Date = sort(unique(c(dates1, dates2))))
setkey(DT, Date)
DT[, smc  := NA_real_]
DT[, alt1 := NA_real_]
DT[.(dates1), smc  := x1]
DT[.(dates2), alt1 := x2]
# replace NA by 0 for accumulation (no event days add zero)
DT[, cum_smc  := cumsum(replace(smc,  is.na(smc),  0))]
DT[, cum_alt1 := cumsum(replace(alt1, is.na(alt1), 0))]
DT[]
}
cum_LM  <- build_cum(s_smc$dates,  s_smc$LM,  s_alt1$dates, s_alt1$LM)
cum_LA  <- build_cum(s_smc$dates,  s_smc$LA,  s_alt1$dates, s_alt1$LA)
# Labels -----------------------------------------------------------------------
asset_name <- s_smc$meta$asset_j
main_tag   <- sprintf("j = %s | a = %.2f, b = %.2f", asset_name, a, b)
# --------- Plot 1: cumulative LM (smc vs alt1) --------------------------------
png("covar_cum_LM_smc_vs_alt1.png", width = 1100, height = 700)
op <- par(no.readonly = TRUE); on.exit({par(op); dev.off()}, add = TRUE)
par(mar = c(4.2, 4.8, 3.2, 10), xaxs = "i", cex.axis = 1.4, cex.lab = 1.5)
with(cum_LM, {
ylim <- range(c(cum_smc, cum_alt1), na.rm = TRUE)
if (!is.finite(ylim[1])) ylim <- c(0, 1)
plot(Date, cum_smc, type = "s", lwd = 3,
xlab = "Date", ylab = "Cumulative LM score",
main = paste("Cumulative LM —", main_tag),
ylim = ylim)
lines(Date, cum_alt1, type = "s", lwd = 3, lty = 2, col = "grey40")
})
legend("right", inset = c(-0.03, 0), xpd = NA, bty = "n",
lwd = 3, lty = c(1, 2), col = c("black", "grey40"),
legend = c("smc", "alt1"), cex = 1.5)
# --------- Plot 2: cumulative LA (smc vs alt1) --------------------------------
png("covar_cum_LA_smc_vs_alt1.png", width = 1100, height = 700)
op2 <- par(no.readonly = TRUE); on.exit({par(op2); dev.off()}, add = TRUE)
par(mar = c(4.2, 4.8, 3.2, 10), xaxs = "i", cex.axis = 1.4, cex.lab = 1.5)
with(cum_LA, {
ylim <- range(c(cum_smc, cum_alt1), na.rm = TRUE)
if (!is.finite(ylim[1])) ylim <- c(0, 1)
plot(Date, cum_smc, type = "s", lwd = 3,
xlab = "Date", ylab = "Cumulative LA score",
main = paste("Cumulative LA —", main_tag),
ylim = ylim)
lines(Date, cum_alt1, type = "s", lwd = 3, lty = 2, col = "grey40")
})
legend("right", inset = c(-0.03, 0), xpd = NA, bty = "n",
lwd = 3, lty = c(1, 2), col = c("black", "grey40"),
legend = c("smc", "alt1"), cex = 1.5)
dev.off()
# Settings ---------------------------------------------------------------------
j_sel     <- 2                  # <-- pick the conditioning asset index
a <- 0.10; b <- 0.10            # CoVaR^{b | j at level a}
date_from <- as.Date("2004-01-01")
date_to   <- as.Date("2025-01-01")
assets_sel <- NULL              # or c("AIG","AXP","BAC", ...)
# Use your existing score builder ------------------------------------------------
s_smc  <- covar_scores(out_list$smc,  data, j = j_sel, a = a, b = b,
date_from = date_from, date_to = date_to, assets = assets_sel)
s_alt1 <- covar_scores(out_list$alt1, data, j = j_sel, a = a, b = b,
date_from = date_from, date_to = date_to, assets = assets_sel)
# Align two date series and build cumulative sums (treat NA as 0 between events)
build_cum <- function(dates1, x1, dates2, x2) {
DT <- data.table(Date = sort(unique(c(dates1, dates2))))
setkey(DT, Date)
DT[, smc  := NA_real_]
DT[, alt1 := NA_real_]
DT[.(dates1), smc  := x1]
DT[.(dates2), alt1 := x2]
DT[, cum_smc  := cumsum(replace(smc,  is.na(smc),  0))]
DT[, cum_alt1 := cumsum(replace(alt1, is.na(alt1), 0))]
DT[]
}
cum_LM <- build_cum(s_smc$dates, s_smc$LM, s_alt1$dates, s_alt1$LM)
cum_LA <- build_cum(s_smc$dates, s_smc$LA, s_alt1$dates, s_alt1$LA)
# Labels
asset_name <- s_smc$meta$asset_j
main_tag   <- sprintf("j = %s | a = %.2f, b = %.2f", asset_name, a, b)
# ---------- ONE FIGURE with two stacked panels ---------------------------------
png("covar_cum_LM_LA_smc_vs_alt1.png", width = 1200, height = 900)
op <- par(no.readonly = TRUE)
on.exit({par(op); dev.off()}, add = TRUE)
par(mfrow = c(2, 1),
mar   = c(4.2, 5.2, 3.0, 10),  # extra right margin for legend on top panel
oma   = c(0, 0, 2.0, 0),
xaxs  = "i",
cex.axis = 1.5, cex.lab = 1.6)
## Panel 1: cumulative LM
with(cum_LM, {
ylim <- range(c(cum_smc, cum_alt1), na.rm = TRUE)
if (!is.finite(ylim[1])) ylim <- c(0, 1)
plot(Date, cum_smc, type = "s", lwd = 3,
xlab = "Date", ylab = "Cumulative LM",
main = paste("Cumulative LM —", main_tag),
ylim = ylim)
lines(Date, cum_alt1, type = "s", lwd = 3, lty = 2, col = "grey40")
})
legend("right", inset = c(-0.03, 0), xpd = NA, bty = "n",
lwd = 3, lty = c(1, 2), col = c("black", "grey40"),
legend = c("smc", "alt1"), cex = 1.5)
## Panel 2: cumulative LA
with(cum_LA, {
ylim <- range(c(cum_smc, cum_alt1), na.rm = TRUE)
if (!is.finite(ylim[1])) ylim <- c(0, 1)
plot(Date, cum_smc, type = "s", lwd = 3,
xlab = "Date", ylab = "Cumulative LA",
main = paste("Cumulative LA —", main_tag),
ylim = ylim)
lines(Date, cum_alt1, type = "s", lwd = 3, lty = 2, col = "grey40")
})
mtext("CoVaR conditional scoring (event days only; NA treated as 0 between events)",
outer = TRUE, cex = 1.3)
# ------------------------------------------------------------------------------
dev.off()
# ---------- ONE FIGURE with two stacked panels ---------------------------------
png("covar_cum_LM_LA_smc_vs_alt1.png", width = 1200, height = 900)
op <- par(no.readonly = TRUE)
on.exit({par(op); dev.off()}, add = TRUE)
par(mfrow = c(2, 1),
mar   = c(4.2, 5.2, 3.0, 10),  # extra right margin for legend on top panel
oma   = c(0, 0, 2.0, 0),
xaxs  = "i",
cex.axis = 1.5, cex.lab = 1.6)
## Panel 1: cumulative LM
with(cum_LM, {
ylim <- range(c(cum_smc, cum_alt1), na.rm = TRUE)
if (!is.finite(ylim[1])) ylim <- c(0, 1)
plot(Date, cum_smc, type = "s", lwd = 3,
xlab = "", ylab = "Cumulative LM",
main = paste("Cumulative LM —", main_tag),
ylim = ylim)
lines(Date, cum_alt1, type = "s", lwd = 3, lty = 2, col = "grey40")
})
legend("bottom", inset = c(-0.03, 0), xpd = NA, bty = "n",
lwd = 3, lty = c(1, 2), col = c("black", "grey40"),
legend = c("smc", "alt1"), cex = 1.5)
## Panel 2: cumulative LA
with(cum_LA, {
ylim <- range(c(cum_smc, cum_alt1), na.rm = TRUE)
if (!is.finite(ylim[1])) ylim <- c(0, 1)
plot(Date, cum_smc, type = "s", lwd = 3,
xlab = "", ylab = "Cumulative LA",
main = paste("Cumulative LA —", main_tag),
ylim = ylim)
lines(Date, cum_alt1, type = "s", lwd = 3, lty = 2, col = "grey40")
})
mtext("CoVaR conditional scoring - AXP",
outer = TRUE, cex = 1.8)
# ------------------------------------------------------------------------------
dev.off()
out_list$smc$fam_hist
dim(out_list$smc$fam_hist)
