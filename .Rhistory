riskVaR <- riskVaR[, pos, , drop = FALSE]
# also reorder CoVaR's asset dimension
dn_covar <- dimnames(CoVaR)
if (!is.null(dn_covar) && length(dn_covar) >= 2 && !is.null(dn_covar[[2]])) {
CoVaR <- CoVaR[, pos, , drop = FALSE]
}
}
# 4) Portfolio VaR backtests
dt_port <- rbindlist(lapply(alphas_var, function(a) {
k <- .which_alpha(alphas_out, a)
q <- as.numeric(portVaR[, k])
h <- var_hits(rp, q)
data.table(
alpha   = a,
n       = length(h),
hits    = sum(h),
rate    = mean(h),
kupiec  = kupiec_test(h, a)$pval,
ind     = christoffersen_ind_test(h)$pval,
cc      = christoffersen_cc_test(h, a)$pval
)
}))
# 5) Asset VaR backtests
dt_asset <- rbindlist(lapply(seq_len(d), function(j) {
rbindlist(lapply(alphas_var, function(a) {
k  <- .which_alpha(alphas_out, a)
qj <- as.numeric(riskVaR[, j, k])
hj <- var_hits(Y[, j], qj)
data.table(
asset = tickers[j], alpha = a,
n = length(hj), hits = sum(hj), rate = mean(hj),
kupiec = kupiec_test(hj, a)$pval,
ind    = christoffersen_ind_test(hj)$pval,
cc     = christoffersen_cc_test(hj, a)$pval
)
}))
}))
# 6) CoVaR backtests (α_j x α_port)
grid <- CJ(alpha_j = alphas_covar, alpha_port = alphas_covar, sorted = TRUE)
# available CoVaR labels in the 3rd dim:
labs_avail <- if (!is.null(dimnames(CoVaR)[[3]])) dimnames(CoVaR)[[3]] else NULL
dt_covar <- rbindlist(lapply(seq_len(nrow(grid)), function(i) {
a <- grid$alpha_j[i]
b <- grid$alpha_port[i]
k <- .which_alpha(alphas_out, a)
# simple label (and a robust fallback if names are like "a0.10b0.10")
lab_simple <- paste0("a", a, "b", b)
lab <- lab_simple
if (!is.null(labs_avail) && !(lab_simple %in% labs_avail)) {
lab_alt <- paste0("a", formatC(a, format = "f", digits = 2),
"b", formatC(b, format = "f", digits = 2))
if (lab_alt %in% labs_avail) lab <- lab_alt
# else: keep lab_simple; will error clearly if not found
}
VaRj  <- matrix(riskVaR[, , k], ncol = d); colnames(VaRj) <- tickers
CoVab <- CoVaR[, , lab, drop = FALSE][, , 1]; colnames(CoVab) <- tickers
cond <- covar_hits_by_j(rp, as.data.table(Y), VaRj, CoVab)
rbindlist(lapply(seq_len(d), function(j) {
hj <- cond$hits[[j]]
if (length(hj) == 0) {
data.table(asset = tickers[j], alpha_j = a, alpha_port = b,
T_event = 0L, rate = NA_real_, kupiec = NA_real_, ind = NA_real_, cc = NA_real_)
} else {
data.table(asset = tickers[j], alpha_j = a, alpha_port = b,
T_event = length(hj), rate = mean(hj),
kupiec = kupiec_test(hj, b)$pval,
ind    = christoffersen_ind_test(hj)$pval,
cc     = christoffersen_cc_test(hj, b)$pval)
}
}))
}))
list(port_var = dt_port[], asset_var = dt_asset[], covar = dt_covar[])
}
# ---- multi-model wrapper ------------------------------------------------------
compare_models <- function(out_list_named,
data,
date_from = as.Date("2003-01-01"),
date_to   = as.Date("2100-01-01"),
assets    = NULL,
alphas_var   = c(0.10, 0.05, 0.025, 0.01),
alphas_covar = c(0.10, 0.05)) {
stopifnot(!is.null(names(out_list_named)), all(nzchar(names(out_list_named))))
res <- lapply(names(out_list_named), function(m) {
out <- out_list_named[[m]]
ans <- evaluate_model(out, data, date_from, date_to, assets, alphas_var, alphas_covar)
list(
port_var  = cbind(model = m, ans$port_var),
asset_var = cbind(model = m, ans$asset_var),
covar     = cbind(model = m, ans$covar)
)
})
list(
port_var  = rbindlist(lapply(res, `[[`, "port_var"),  use.names = TRUE, fill = TRUE),
asset_var = rbindlist(lapply(res, `[[`, "asset_var"), use.names = TRUE, fill = TRUE),
covar     = rbindlist(lapply(res, `[[`, "covar"),     use.names = TRUE, fill = TRUE)
)
}
# ---- example usage ------------------------------------------------------------
# Load data once
data <- import_data(drop_first_col = FALSE, n_assets = 5)
# Load as many 'out' objects as you want and name them for comparison
out_list <- list(
# smc252_5   = readRDS("empirical_results/standard_tip_w252_M2000_tipk13.rds"),
smc252_10   = readRDS("empirical_results/standard_tip_w252_M2000_tipk10.rds"),
# smc252_15   = readRDS("empirical_results/standard_tip_w252_M2000_tipk38.rds"),
# smc126_5   = readRDS("empirical_results/standard_tip_w126_M2000_tipk6.rds"),
# smc126_10   = readRDS("empirical_results/standard_tip_w126_M2000_tipk13.rds"),
# smc126_15   = readRDS("empirical_results/standard_tip_w126_M2000_tipk19.rds"),
# smc504_5   = readRDS("empirical_results/standard_tip_w504_M2000_tipk25.rds"),
# smc504_10   = readRDS("empirical_results/standard_tip_w504_M2000_tipk50.rds"),
# smc504_15   = readRDS("empirical_results/standard_tip_w504_M2000_tipk76.rds")
alt2   = readRDS("empirical_results/standard_tip.rds")
)
# Load as many 'out' objects as you want and name them for comparison
out_list <- list(
smc252_5   = readRDS("empirical_results/standard_tip_w252_M2000_tipk5.rds"),
smc252_10   = readRDS("empirical_results/standard_tip_w252_M2000_tipk10.rds"),
# smc252_15   = readRDS("empirical_results/standard_tip_w252_M2000_tipk38.rds"),
# smc126_5   = readRDS("empirical_results/standard_tip_w126_M2000_tipk6.rds"),
# smc126_10   = readRDS("empirical_results/standard_tip_w126_M2000_tipk13.rds"),
# smc126_15   = readRDS("empirical_results/standard_tip_w126_M2000_tipk19.rds"),
# smc504_5   = readRDS("empirical_results/standard_tip_w504_M2000_tipk25.rds"),
# smc504_10   = readRDS("empirical_results/standard_tip_w504_M2000_tipk50.rds"),
# smc504_15   = readRDS("empirical_results/standard_tip_w504_M2000_tipk76.rds")
alt2   = readRDS("empirical_results/standard_tip.rds")
)
# ---- setup -------------------------------------------------------------------
library(data.table)
library(here)
source(here("src/R", "config.R"))   # must provide import_data()
# ---- tests -------------------------------------------------------------------
var_hits <- function(y, q) as.numeric(y <= q)
kupiec_test <- function(h, alpha) {
n  <- length(h)
n1 <- sum(h)
n0 <- n - n1
# guard against 0/1 proportions
pi_hat <- if (n > 0) n1 / n else NA_real_
if (is.na(pi_hat) || pi_hat %in% c(0,1)) {
return(list(stat = NA_real_, pval = NA_real_, rate = pi_hat))
}
lr_uc <- -2 * ( n0*log1p(-alpha) + n1*log(alpha) -
( n0*log1p(-pi_hat) + n1*log(pi_hat) ) )
pval  <- 1 - pchisq(lr_uc, df = 1)
list(stat = lr_uc, pval = pval, rate = pi_hat)
}
christoffersen_ind_test <- function(h) {
if (length(h) < 2) return(list(stat = NA_real_, pval = NA_real_))
hlag  <- c(NA, h[-length(h)])
valid <- !is.na(hlag)
h     <- h[valid]; hlag <- hlag[valid]
n00 <- sum(hlag == 0 & h == 0)
n01 <- sum(hlag == 0 & h == 1)
n10 <- sum(hlag == 1 & h == 0)
n11 <- sum(hlag == 1 & h == 1)
n0  <- n00 + n01; n1 <- n10 + n11
# add tiny eps to avoid log(0)
eps <- 1e-12
pi   <- (n01 + n11) / (n0 + n1 + eps)
pi0  <- if (n0 > 0) n01 / (n0 + eps) else 0
pi1  <- if (n1 > 0) n11 / (n1 + eps) else 0
ll_ind <- (n00*log1p(-pi0+eps) + n01*log(pi0+eps) +
n10*log1p(-pi1+eps) + n11*log(pi1+eps))
ll_iid <- ((n0 + n1 - (n01 + n11))*log1p(-pi+eps) + (n01 + n11)*log(pi+eps))
lr_ind <- -2 * (ll_iid - ll_ind)
pval   <- 1 - pchisq(lr_ind, df = 1)
list(stat = lr_ind, pval = pval)
}
christoffersen_cc_test <- function(h, alpha) {
uc  <- kupiec_test(h, alpha)
ind <- christoffersen_ind_test(h)
if (any(is.na(c(uc$stat, ind$stat)))) {
return(list(stat = NA_real_, pval = NA_real_))
}
stat <- uc$stat + ind$stat
list(stat = stat, pval = 1 - pchisq(stat, df = 2))
}
# ---- helpers -----------------------------------------------------------------
# find alpha index in a numeric vector alphas for a target a
.which_alpha <- function(alphas, a) {
i <- which.min(abs(alphas - a))
if (length(i) == 0L || !is.finite(i)) stop("Cannot match alpha.")
i
}
# label maker for CoVaR dimension names like "a0.05b0.1"
#.fmt_ab <- function(x) sub("0\\.(\\d\\d?)$", "0.\\1", formatC(x, format = "fg", digits = 3, drop0trailing = FALSE))
#.covar_lab <- function(a, b) paste0("a", .fmt_ab(a), "b", .fmt_ab(b))
# Build conditional hit series for CoVaR^{p|j}
covar_hits_by_j <- function(r_p_real, y_real_oos, VaRj_oos, CoVaR_oos) {
d <- ncol(y_real_oos)
hits_list <- vector("list", d)
n_list    <- integer(d)
for (j in seq_len(d)) {
mask <- y_real_oos[[j]] <= VaRj_oos[, j]
n_list[j] <- sum(mask)
hits_list[[j]] <- if (n_list[j] > 0) as.numeric(r_p_real[mask] <= CoVaR_oos[mask, j]) else numeric(0)
}
list(hits = hits_list, n = n_list)
}
# Align data$y_real to out-of-sample arrays in `out` and filter by Date range
# Align data$y_real to out-of-sample arrays in `out` and filter by Date range
align_and_filter <- function(out, data,
date_from = as.Date("1900-01-01"),
date_to   = as.Date("2100-01-01"),
keep_cols = NULL) {
stopifnot("y_real" %in% names(data))
y_dt <- as.data.table(data$y_real)
if (!"Date" %in% names(y_dt)) stop("data$y_real must have a Date column.")
setkey(y_dt, Date)
n_oos <- nrow(out$port$VaR)
if (!is.finite(n_oos) || n_oos <= 0) stop("out$port$VaR must be n_oos x K.")
# --- exact OOS block used by the model (by *position*) ---
y_oos <- y_dt[(.N - n_oos + 1L):.N]
stopifnot(nrow(y_oos) == n_oos)
# Optional asset subset (keep order)
if (!is.null(keep_cols)) {
cols <- c("Date", keep_cols)
missing <- setdiff(cols, names(y_oos))
if (length(missing)) stop("Missing columns in y_real: ", paste(missing, collapse = ", "))
y_oos <- y_oos[, ..cols]
}
# --- build indices of the OOS block that pass the date filter ---
keep_idx <- which(y_oos$Date >= date_from & y_oos$Date <= date_to)
# Drop Date for matrices; keep tickers and the original OOS dates for indexing
tickers <- setdiff(colnames(y_oos), "Date")
Y_full  <- as.matrix(y_oos[, ..tickers])   # n_oos x d
list(
dates_oos  = y_oos$Date,        # length n_oos
keep_idx   = keep_idx,          # positions within OOS block
Y_keep     = Y_full[keep_idx, , drop = FALSE],  # filtered Y
tickers    = tickers
)
}
# ---- single-model evaluator ---------------------------------------------------
evaluate_model <- function(out, data,
date_from = as.Date("2003-01-01"),
date_to   = as.Date("2100-01-01"),
assets    = NULL,
alphas_var   = c(0.10, 0.05, 0.025, 0.01),
alphas_covar = c(0.10, 0.05)) {
# 1) Align & filter by date
aligned  <- align_and_filter(out, data, date_from, date_to, keep_cols = assets)
Y        <- aligned$Y_keep                     # (n_keep x d) filtered by dates
keep_idx <- aligned$keep_idx                   # positions within the OOS block
tickers  <- aligned$tickers
d        <- ncol(Y)
rp       <- rowMeans(Y)
# 2) Alpha grid for VaR arrays
alphas_out <- if (!is.null(out$cfg$alphas)) as.numeric(out$cfg$alphas)
else stop("out$cfg$alphas missing or unknown.")
# 3) Subset model arrays by the *same indices* (no tail())
# portVaR: (n_oos x K) -> (n_keep x K)
portVaR <- out$port$VaR[keep_idx, , drop = FALSE]
# riskVaR: (n_oos x d x K) -> (n_keep x d x K)
riskVaR <- out$risk$VaR[keep_idx, , , drop = FALSE]
# CoVaR: (n_oos x d x L) -> (n_keep x d x L)
CoVaR   <- out$CoVaR_tail[keep_idx, , , drop = FALSE]
# (optional) ensure asset order matches tickers if dimnames exist
dn_risk <- dimnames(riskVaR)
if (!is.null(dn_risk) && length(dn_risk) >= 2 && !is.null(dn_risk[[2]])) {
pos <- match(tickers, dn_risk[[2]])
if (anyNA(pos)) stop("Some tickers not found in out$risk$VaR dimnames.")
riskVaR <- riskVaR[, pos, , drop = FALSE]
# also reorder CoVaR's asset dimension
dn_covar <- dimnames(CoVaR)
if (!is.null(dn_covar) && length(dn_covar) >= 2 && !is.null(dn_covar[[2]])) {
CoVaR <- CoVaR[, pos, , drop = FALSE]
}
}
# 4) Portfolio VaR backtests
dt_port <- rbindlist(lapply(alphas_var, function(a) {
k <- .which_alpha(alphas_out, a)
q <- as.numeric(portVaR[, k])
h <- var_hits(rp, q)
data.table(
alpha   = a,
n       = length(h),
hits    = sum(h),
rate    = mean(h),
kupiec  = kupiec_test(h, a)$pval,
ind     = christoffersen_ind_test(h)$pval,
cc      = christoffersen_cc_test(h, a)$pval
)
}))
# 5) Asset VaR backtests
dt_asset <- rbindlist(lapply(seq_len(d), function(j) {
rbindlist(lapply(alphas_var, function(a) {
k  <- .which_alpha(alphas_out, a)
qj <- as.numeric(riskVaR[, j, k])
hj <- var_hits(Y[, j], qj)
data.table(
asset = tickers[j], alpha = a,
n = length(hj), hits = sum(hj), rate = mean(hj),
kupiec = kupiec_test(hj, a)$pval,
ind    = christoffersen_ind_test(hj)$pval,
cc     = christoffersen_cc_test(hj, a)$pval
)
}))
}))
# 6) CoVaR backtests (α_j x α_port)
grid <- CJ(alpha_j = alphas_covar, alpha_port = alphas_covar, sorted = TRUE)
# available CoVaR labels in the 3rd dim:
labs_avail <- if (!is.null(dimnames(CoVaR)[[3]])) dimnames(CoVaR)[[3]] else NULL
dt_covar <- rbindlist(lapply(seq_len(nrow(grid)), function(i) {
a <- grid$alpha_j[i]
b <- grid$alpha_port[i]
k <- .which_alpha(alphas_out, a)
# simple label (and a robust fallback if names are like "a0.10b0.10")
lab_simple <- paste0("a", a, "b", b)
lab <- lab_simple
if (!is.null(labs_avail) && !(lab_simple %in% labs_avail)) {
lab_alt <- paste0("a", formatC(a, format = "f", digits = 2),
"b", formatC(b, format = "f", digits = 2))
if (lab_alt %in% labs_avail) lab <- lab_alt
# else: keep lab_simple; will error clearly if not found
}
VaRj  <- matrix(riskVaR[, , k], ncol = d); colnames(VaRj) <- tickers
CoVab <- CoVaR[, , lab, drop = FALSE][, , 1]; colnames(CoVab) <- tickers
cond <- covar_hits_by_j(rp, as.data.table(Y), VaRj, CoVab)
rbindlist(lapply(seq_len(d), function(j) {
hj <- cond$hits[[j]]
if (length(hj) == 0) {
data.table(asset = tickers[j], alpha_j = a, alpha_port = b,
T_event = 0L, rate = NA_real_, kupiec = NA_real_, ind = NA_real_, cc = NA_real_)
} else {
data.table(asset = tickers[j], alpha_j = a, alpha_port = b,
T_event = length(hj), rate = mean(hj),
kupiec = kupiec_test(hj, b)$pval,
ind    = christoffersen_ind_test(hj)$pval,
cc     = christoffersen_cc_test(hj, b)$pval)
}
}))
}))
list(port_var = dt_port[], asset_var = dt_asset[], covar = dt_covar[])
}
# ---- multi-model wrapper ------------------------------------------------------
compare_models <- function(out_list_named,
data,
date_from = as.Date("2003-01-01"),
date_to   = as.Date("2100-01-01"),
assets    = NULL,
alphas_var   = c(0.10, 0.05, 0.025, 0.01),
alphas_covar = c(0.10, 0.05)) {
stopifnot(!is.null(names(out_list_named)), all(nzchar(names(out_list_named))))
res <- lapply(names(out_list_named), function(m) {
out <- out_list_named[[m]]
ans <- evaluate_model(out, data, date_from, date_to, assets, alphas_var, alphas_covar)
list(
port_var  = cbind(model = m, ans$port_var),
asset_var = cbind(model = m, ans$asset_var),
covar     = cbind(model = m, ans$covar)
)
})
list(
port_var  = rbindlist(lapply(res, `[[`, "port_var"),  use.names = TRUE, fill = TRUE),
asset_var = rbindlist(lapply(res, `[[`, "asset_var"), use.names = TRUE, fill = TRUE),
covar     = rbindlist(lapply(res, `[[`, "covar"),     use.names = TRUE, fill = TRUE)
)
}
# ---- example usage ------------------------------------------------------------
# Load data once
data <- import_data(drop_first_col = FALSE, n_assets = 5)
# Load as many 'out' objects as you want and name them for comparison
out_list <- list(
smc252_5   = readRDS("empirical_results/standard_tip_w252_M2000_tipk5.rds"),
#smc252_10   = readRDS("empirical_results/standard_tip_w252_M2000_tipk10.rds"),
# smc252_15   = readRDS("empirical_results/standard_tip_w252_M2000_tipk38.rds"),
# smc126_5   = readRDS("empirical_results/standard_tip_w126_M2000_tipk6.rds"),
# smc126_10   = readRDS("empirical_results/standard_tip_w126_M2000_tipk13.rds"),
# smc126_15   = readRDS("empirical_results/standard_tip_w126_M2000_tipk19.rds"),
# smc504_5   = readRDS("empirical_results/standard_tip_w504_M2000_tipk25.rds"),
# smc504_10   = readRDS("empirical_results/standard_tip_w504_M2000_tipk50.rds"),
# smc504_15   = readRDS("empirical_results/standard_tip_w504_M2000_tipk76.rds")
#alt2   = readRDS("empirical_results/standard_tip.rds")
)
# Load as many 'out' objects as you want and name them for comparison
out_list <- list(
smc252_5   = readRDS("empirical_results/standard_tip_w252_M2000_tipk5.rds")
#smc252_10   = readRDS("empirical_results/standard_tip_w252_M2000_tipk10.rds"),
# smc252_15   = readRDS("empirical_results/standard_tip_w252_M2000_tipk38.rds"),
# smc126_5   = readRDS("empirical_results/standard_tip_w126_M2000_tipk6.rds"),
# smc126_10   = readRDS("empirical_results/standard_tip_w126_M2000_tipk13.rds"),
# smc126_15   = readRDS("empirical_results/standard_tip_w126_M2000_tipk19.rds"),
# smc504_5   = readRDS("empirical_results/standard_tip_w504_M2000_tipk25.rds"),
# smc504_10   = readRDS("empirical_results/standard_tip_w504_M2000_tipk50.rds"),
# smc504_15   = readRDS("empirical_results/standard_tip_w504_M2000_tipk76.rds")
#alt2   = readRDS("empirical_results/standard_tip.rds")
)
# Choose period & assets by name (Date handling is centralized and consistent)
date_from <- as.Date("2004-01-01")
date_to   <- as.Date("2025-01-01")
assets_sel <- NULL            # or c("AIG","AXP","BAC") to force a set/order
# Run comparison
cmp <- compare_models(
out_list_named = out_list,
data           = data,
date_from      = date_from,
date_to        = date_to,
assets         = assets_sel,
alphas_var     = c(0.10, 0.05, 0.025, 0.01),
alphas_covar   = c(0.10, 0.05)
)
# Tidy results ready for tables/plots:
# cmp$port_var  # columns: model, alpha, n, hits, rate, kupiec, ind, cc
# cmp$asset_var # columns: model, asset, alpha, n, hits, rate, kupiec, ind, cc
cmp$covar[(alpha_j == 0.05)&(alpha_port  == 0.05)&(asset  == "AIG")]     # columns: model, asset, alpha_j, alpha_port, T_event, rate, kupiec, ind, cc
# Load as many 'out' objects as you want and name them for comparison
out_list <- list(
#smc252_5   = readRDS("empirical_results/standard_tip_w252_M2000_tipk5.rds")
smc252_10   = readRDS("empirical_results/standard_tip_w252_M2000_tipk10.rds"),
# smc252_15   = readRDS("empirical_results/standard_tip_w252_M2000_tipk38.rds"),
# smc126_5   = readRDS("empirical_results/standard_tip_w126_M2000_tipk6.rds"),
# smc126_10   = readRDS("empirical_results/standard_tip_w126_M2000_tipk13.rds"),
# smc126_15   = readRDS("empirical_results/standard_tip_w126_M2000_tipk19.rds"),
# smc504_5   = readRDS("empirical_results/standard_tip_w504_M2000_tipk25.rds"),
# smc504_10   = readRDS("empirical_results/standard_tip_w504_M2000_tipk50.rds"),
# smc504_15   = readRDS("empirical_results/standard_tip_w504_M2000_tipk76.rds")
#alt2   = readRDS("empirical_results/standard_tip.rds")
)
# Load as many 'out' objects as you want and name them for comparison
out_list <- list(
#smc252_5   = readRDS("empirical_results/standard_tip_w252_M2000_tipk5.rds")
smc252_10   = readRDS("empirical_results/standard_tip_w252_M2000_tipk10.rds")
# smc252_15   = readRDS("empirical_results/standard_tip_w252_M2000_tipk38.rds"),
# smc126_5   = readRDS("empirical_results/standard_tip_w126_M2000_tipk6.rds"),
# smc126_10   = readRDS("empirical_results/standard_tip_w126_M2000_tipk13.rds"),
# smc126_15   = readRDS("empirical_results/standard_tip_w126_M2000_tipk19.rds"),
# smc504_5   = readRDS("empirical_results/standard_tip_w504_M2000_tipk25.rds"),
# smc504_10   = readRDS("empirical_results/standard_tip_w504_M2000_tipk50.rds"),
# smc504_15   = readRDS("empirical_results/standard_tip_w504_M2000_tipk76.rds")
#alt2   = readRDS("empirical_results/standard_tip.rds")
)
# Choose period & assets by name (Date handling is centralized and consistent)
date_from <- as.Date("2004-01-01")
date_to   <- as.Date("2025-01-01")
assets_sel <- NULL            # or c("AIG","AXP","BAC") to force a set/order
# Run comparison
cmp <- compare_models(
out_list_named = out_list,
data           = data,
date_from      = date_from,
date_to        = date_to,
assets         = assets_sel,
alphas_var     = c(0.10, 0.05, 0.025, 0.01),
alphas_covar   = c(0.10, 0.05)
)
# Tidy results ready for tables/plots:
# cmp$port_var  # columns: model, alpha, n, hits, rate, kupiec, ind, cc
# cmp$asset_var # columns: model, asset, alpha, n, hits, rate, kupiec, ind, cc
cmp$covar[(alpha_j == 0.05)&(alpha_port  == 0.05)&(asset  == "AIG")]     # columns: model, asset, alpha_j, alpha_port, T_event, rate, kupiec, ind, cc
# Load as many 'out' objects as you want and name them for comparison
out_list <- list(
#smc252_5   = readRDS("empirical_results/standard_tip_w252_M2000_tipk5.rds")
#smc252_10   = readRDS("empirical_results/standard_tip_w252_M2000_tipk10.rds")
smc252_15   = readRDS("empirical_results/standard_tip_w252_M2000_tipk15.rds")
# smc126_5   = readRDS("empirical_results/standard_tip_w126_M2000_tipk6.rds"),
# smc126_10   = readRDS("empirical_results/standard_tip_w126_M2000_tipk13.rds"),
# smc126_15   = readRDS("empirical_results/standard_tip_w126_M2000_tipk19.rds"),
# smc504_5   = readRDS("empirical_results/standard_tip_w504_M2000_tipk25.rds"),
# smc504_10   = readRDS("empirical_results/standard_tip_w504_M2000_tipk50.rds"),
# smc504_15   = readRDS("empirical_results/standard_tip_w504_M2000_tipk76.rds")
#alt2   = readRDS("empirical_results/standard_tip.rds")
)
# Choose period & assets by name (Date handling is centralized and consistent)
date_from <- as.Date("2004-01-01")
date_to   <- as.Date("2025-01-01")
assets_sel <- NULL            # or c("AIG","AXP","BAC") to force a set/order
# Run comparison
cmp <- compare_models(
out_list_named = out_list,
data           = data,
date_from      = date_from,
date_to        = date_to,
assets         = assets_sel,
alphas_var     = c(0.10, 0.05, 0.025, 0.01),
alphas_covar   = c(0.10, 0.05)
)
# Tidy results ready for tables/plots:
# cmp$port_var  # columns: model, alpha, n, hits, rate, kupiec, ind, cc
# cmp$asset_var # columns: model, asset, alpha, n, hits, rate, kupiec, ind, cc
cmp$covar[(alpha_j == 0.05)&(alpha_port  == 0.05)&(asset  == "AIG")]     # columns: model, asset, alpha_j, alpha_port, T_event, rate, kupiec, ind, cc
# target moderate |tau|; map to rho; pick df
tau <- runif(1, 0.2, 0.6) * sample(c(-1, 1), 1)
rho <- sin(pi * tau / 2)
nu  <- sample(c(3, 7), 1)
nu
sample(c(3, 7), 1)
sample(c(3, 7), 1)
sample(c(3, 7), 1)
sample(c(3, 7), 1)
sample(c(3, 7), 1)
sample(c(3, 7), 1)
sample(c(3, 7), 1)
nu  <- sample([3, 7], 1)
nu  <- runif(1, 2, 10)
nu  <- runif(1, 2, 10)
nu
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
runif(1, 2, 10)
