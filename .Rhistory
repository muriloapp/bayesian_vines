})
)
worst <- rmse_naive %>%
filter(cond_asset == 2, scenario == "a0.05b0.025") %>%
slice_max(RMSE, n = 3, with_ties = FALSE)
worst$obj_id
worst$RMSE
df <- obj_naive[[288]]
df$piece$regimes[[1]]
rmse_naive <- bind_rows(
lapply(seq_along(obj_naive), function(i) {
df <- obj_naive[[i]][["rmse_mae_from_covar"]]
df$obj_id <- i
df
})
)
worst <- rmse_naive %>%
filter(cond_asset == 2, scenario == "a0.05b0.025") %>%
slice_max(RMSE, n = 4, with_ties = FALSE)
worst$obj_id
worst$RMSE
df <- obj_naive[[65]]
df$piece$regimes[[1]]
folder_smc <- "SMC/mlNA_w252_wp1000_re001"
folder_smc     <- file.path("simul_results", folder_smc)
files_smc <- list.files(folder_smc, pattern = "\\.rds$", full.names = TRUE)
obj_smc <- lapply(files_smc, readRDS)
folder_naive <- "NAIVE_300/mlNA_w252_wp0252_re252"
folder_naive     <- file.path("simul_results", folder_naive)
files_naive <- list.files(folder_naive, pattern = "\\.rds$", full.names = TRUE)
obj_naive <- lapply(files_naive, readRDS)
obj_smc[[1]]$log_pred
obj_smc[[1]]$QL
rmse_smc  <- bind_rows(lapply(obj_smc, `[[`, "QL"))
rmse_smc
QL_smc  <- bind_rows(lapply(obj_smc, `[[`, "QL"))
QL_naive <- bind_rows(lapply(obj_naive, `[[`, "QL"))
QL_smc  <- bind_rows(lapply(obj_smc, `[[`, "QL"))["a0.025"]
QL_smc
sum(bind_rows(lapply(obj_smc, `[[`, "QL"))["a0.025"])
sum(bind_rows(lapply(obj_naive, `[[`, "QL"))["a0.025"])
library(dplyr)
library(ggplot2)
logpred_smc <- tibble(
file = basename(files_smc),
sum_log_pred = sapply(obj_smc, function(o) sum(o$log_pred, na.rm = TRUE))
)
logpred_naive <- tibble(
file = basename(files_naive),
sum_log_pred = sapply(obj_naive, function(o) sum(o$log_pred, na.rm = TRUE))
)
logpred_naive
sum(logpred_smc)
sum(logpred_smc$sum_log_pred)
mean(logpred_smc$sum_log_pred)
mean(logpred_naive$sum_log_pred)
obj_naive[[1]]$wCRPS
wCRPS_smc  <- sum(bind_rows(lapply(obj_smc, `[[`, "wCRPS")))
wCRPS_naive <-  sum(bind_rows(lapply(obj_naive, `[[`, "wCRPS")))
obj_smc
bind_rows(lapply(obj_smc, `[[`, "wCRPS"))
obj_smc[[1]]$FZL
FZLL_smc  <- sum(bind_rows(lapply(obj_smc, `[[`, "FZL"))["a0.025"])
FZL_naive <-  sum(bind_rows(lapply(obj_naive, `[[`, "FZL"))["a0.025"])
FZLL_smc
FZL_naive
FZLL_smc  <- mean(bind_rows(lapply(obj_smc, `[[`, "FZL"))["a0.025"])
FZL_naive <-  mean(bind_rows(lapply(obj_naive, `[[`, "FZL"))["a0.025"])
FZLL_smc  <- mean(bind_rows(lapply(obj_smc, `[[`, "FZL"))["a0.025"])
bind_rows(lapply(obj_smc, `[[`, "FZL"))["a0.025"]
######
library(dplyr)
library(ggplot2)
library(patchwork)
# subset rows for the scenario/asset
s1 <- rmse_smc  %>% filter(cond_asset == 2, scenario == "a0.05b0.025")
# pick zoom limits (adjust probs to zoom more/less)
library(ggplot2)
df <- data.frame(rmse_A, rmse_B)
lims <- quantile(c(df$rmse_A, df$rmse_B), c(0.025, 0.975), na.rm = TRUE)
ggplot(df, aes(rmse_A, rmse_B)) +
geom_point() +
geom_abline(intercept = 0, slope = 1) +
coord_equal(xlim = lims, ylim = lims) +
labs(x = "RMSE (Model A)", y = "RMSE (Model B)") +
theme_minimal()
####### subset
s1 <- rmse_smc [rmse_smc$cond_asset == 2 & rmse_smc$scenario == "a0.05b0.025", , drop=FALSE]
s2 <- rmse_naive[rmse_naive$cond_asset == 2 & rmse_naive$scenario == "a0.05b0.025", , drop=FALSE]
####### subset
s1 <- rmse_smc [rmse_smc$cond_asset == 2 & rmse_smc$scenario == "a0.05b0.025", , drop=FALSE]
rmse_smc$cond_asset
folder_smc <- "SMC/mlNA_w252_wp1000_re001"
folder_smc     <- file.path("simul_results", folder_smc)
files_smc <- list.files(folder_smc, pattern = "\\.rds$", full.names = TRUE)
obj_smc <- lapply(files_smc, readRDS)
folder_naive <- "NAIVE_300/mlNA_w252_wp0252_re252"
folder_naive     <- file.path("simul_results", folder_naive)
files_naive <- list.files(folder_naive, pattern = "\\.rds$", full.names = TRUE)
obj_naive <- lapply(files_naive, readRDS)
rmse_smc  <- bind_rows(lapply(obj_smc, `[[`, "rmse_mae_from_covar"))
covar_smc <- bind_rows(lapply(obj_smc, `[[`, "eval_covar_asset"))
rmse_naive  <- bind_rows(lapply(obj_naive, `[[`, "rmse_mae_from_covar"))
covar_naive <- bind_rows(lapply(obj_naive, `[[`, "eval_covar_asset"))
s1 <- rmse_smc [rmse_smc$cond_asset == 2 & rmse_smc$scenario == "a0.05b0.025", , drop=FALSE]
s2 <- rmse_naive[rmse_naive$cond_asset == 2 & rmse_naive$scenario == "a0.05b0.025", , drop=FALSE]
# vectors
rmse_A <- s1$RMSE; rmse_B <- s2$RMSE
mae_A  <- s1$MAE;  mae_B  <- s2$MAE
# zoom limits (same idea as before, but base R)
lims_rmse <- as.numeric(quantile(c(rmse_A, rmse_B), probs = c(0.025, 0.975), na.rm = TRUE))
lims_mae  <- as.numeric(quantile(c(mae_A,  mae_B ), probs = c(0.025, 0.975), na.rm = TRUE))
op <- par(mfrow = c(1, 2), mar = c(4, 4, 2, 1) + 0.1)  # 1 row, 2 cols
on.exit(par(op), add = TRUE)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1, pch = 19,
xlab = "RMSE (SMC)", ylab = "RMSE (NAIVE)",
main = "RMSE")
abline(a = 0, b = 1, lwd = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1, pch = 19,
xlab = "MAE (SMC)", ylab = "MAE (NAIVE)",
main = "MAE")
abline(a = 0, b = 1, lwd = 2)
folder_smc <- "SMC/mlNA_w252_wp1000_re001"
folder_smc     <- file.path("simul_results", folder_smc)
files_smc <- list.files(folder_smc, pattern = "\\.rds$", full.names = TRUE)
obj_smc <- lapply(files_smc, readRDS)
folder_naive <- "NAIVE_300/mlNA_w252_wp0252_re252"
folder_naive     <- file.path("simul_results", folder_naive)
files_naive <- list.files(folder_naive, pattern = "\\.rds$", full.names = TRUE)
obj_naive <- lapply(files_naive, readRDS)
rmse_smc  <- bind_rows(lapply(obj_smc, `[[`, "rmse_mae_from_covar"))
covar_smc <- bind_rows(lapply(obj_smc, `[[`, "eval_covar_asset"))
rmse_naive  <- bind_rows(lapply(obj_naive, `[[`, "rmse_mae_from_covar"))
covar_naive <- bind_rows(lapply(obj_naive, `[[`, "eval_covar_asset"))
# subset to your condition
s1 <- rmse_smc  [rmse_smc$cond_asset == 2 & rmse_smc$scenario  == "a0.05b0.025", , drop=FALSE]
s2 <- rmse_naive[rmse_naive$cond_asset == 2 & rmse_naive$scenario == "a0.05b0.025", , drop=FALSE]
# vectors
rmse_A <- s1$RMSE; rmse_B <- s2$RMSE
mae_A  <- s1$MAE;  mae_B  <- s2$MAE
# zoom limits using 0.025 and 0.975
lims_rmse <- as.numeric(quantile(c(rmse_A, rmse_B), probs = c(0.025, 0.975), na.rm = TRUE))
lims_mae  <- as.numeric(quantile(c(mae_A,  mae_B ), probs = c(0.025, 0.975), na.rm = TRUE))
op <- par(mfrow = c(1, 2), mar = c(4, 4, 2.5, 1) + 0.1)
on.exit(par(op), add = TRUE)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 19,
xlab = "RMSE (SMC)",
ylab = "RMSE (NAIVE)",
main = "RMSE")
abline(0, 1, lwd = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 19,
xlab = "MAE (SMC)",
ylab = "MAE (NAIVE)",
main = "MAE")
abline(0, 1, lwd = 2)
# zoom limits using 0.025 and 0.975
lims_rmse <- as.numeric(quantile(c(rmse_A, rmse_B), probs = c(0.01, 0.99), na.rm = TRUE))
lims_mae  <- as.numeric(quantile(c(mae_A,  mae_B ), probs = c(0.01, 0.99), na.rm = TRUE))
op <- par(mfrow = c(1, 2), mar = c(4, 4, 2.5, 1) + 0.1)
on.exit(par(op), add = TRUE)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 19,
xlab = "RMSE (SMC)",
ylab = "RMSE (NAIVE)",
main = "RMSE")
abline(0, 1, lwd = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 19,
xlab = "MAE (SMC)",
ylab = "MAE (NAIVE)",
main = "MAE")
abline(0, 1, lwd = 2)
# zoom limits using 0.025 and 0.975
lims_rmse <- as.numeric(quantile(c(rmse_A, rmse_B), probs = c(0.02, 0.98), na.rm = TRUE))
lims_mae  <- as.numeric(quantile(c(mae_A,  mae_B ), probs = c(0.01, 0.99), na.rm = TRUE))
op <- par(mfrow = c(1, 2), mar = c(4, 4, 2.5, 1) + 0.1)
on.exit(par(op), add = TRUE)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 19,
xlab = "RMSE (SMC)",
ylab = "RMSE (NAIVE)",
main = "RMSE")
abline(0, 1, lwd = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 19,
xlab = "MAE (SMC)",
ylab = "MAE (NAIVE)",
main = "MAE")
abline(0, 1, lwd = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 2, col = "grey70")
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 2, col = "grey70")
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 2, col = "grey50")
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 2, col = "grey50")
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
op <- par(mfrow = c(1, 2), mar = c(4, 4, 2.5, 1) + 0.1)
on.exit(par(op), add = TRUE)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 1,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 12,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 3,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 4,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 5,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 6,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 7,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 8,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 9,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 10,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 11,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 13,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 14,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 15,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 16,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 17,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 18,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 20,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 18,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 18,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- RMSE panel ---
plot(rmse_A, rmse_B,
xlim = lims_rmse, ylim = lims_rmse,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "RMSE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
# --- MAE panel ---
plot(mae_A, mae_B,
xlim = lims_mae, ylim = lims_mae,
asp  = 1,
pch  = 19,
xlab = "SMC",
ylab = "Naive",
main = "MAE")
abline(0, 1, lwd = 1.5, col = gray(0.75), lty = 2)
